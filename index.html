<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ðŸ’— Gutachten Manager Deluxe</title>

<meta name="theme-color" content="#ff69b4">

<style>
:root{
  --pink:#ff69b4;
  --pink2:#ffb6c1;
  --bg:#ffe6f0;
  --card:#fff;
  --border:rgba(0,0,0,.1);
  --shadow:0 10px 25px rgba(0,0,0,.08);
  --radius:18px;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:var(--bg);
}
.wrap{
  max-width:1100px;
  margin:20px auto;
  padding:15px;
}
.card{
  background:var(--card);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:16px;
  margin-bottom:14px;
}
h1{margin:0 0 6px;font-size:22px}
.sub{color:#666;font-size:13px;margin:0}

.grid{
  display:grid;
  gap:14px;
}
@media(min-width:900px){
  .grid{grid-template-columns:380px 1fr}
}

label{font-size:12px;color:#666}
input,select{
  width:100%;
  padding:10px;
  border-radius:12px;
  border:1px solid var(--border);
}
button{
  border:0;
  border-radius:12px;
  padding:10px 14px;
  font-weight:600;
  cursor:pointer;
  background:var(--pink2);
}
button:hover{filter:brightness(.95)}
.btn-outline{
  background:#fff;
  border:1px solid var(--border);
}
.danger{
  border:1px solid #c55;
  color:#922;
  background:#fff;
}
.btns{display:flex;gap:10px;flex-wrap:wrap}

.tableWrap{overflow:auto}
table{
  width:100%;
  border-collapse:collapse;
  min-width:900px;
}
th,td{
  padding:8px;
  border-bottom:1px solid #eee;
  font-size:13px;
  white-space:nowrap;
}
th{background:#fafafa}

.pill{
  padding:3px 8px;
  border-radius:999px;
  border:1px solid #ccc;
  font-size:12px;
}
.paid{background:#e7f8ee;border-color:#8ccfa6}
.unpaid{background:#fdeaea;border-color:#e6a0a0}

.bar{
  height:14px;
  background:#eee;
  border-radius:999px;
  overflow:hidden;
}
.bar div{
  height:100%;
  background:linear-gradient(90deg,#ff9acb,var(--pink));
}

nav button.tab-active{
  background:linear-gradient(90deg,#ff9acb,var(--pink));
}

.toast{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  background:#fff;
  border:1px solid var(--border);
  padding:10px 14px;
  border-radius:999px;
  box-shadow:var(--shadow);
  display:none;
}
.toast.show{display:block}
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
<div class="wrap">

<div class="card">
<h1>ðŸ’— Gutachten Manager Deluxe</h1>
<p class="sub">Gutachten + Arbeitsplan â€“ alles lokal gespeichert</p>
</div>

<nav class="card">
<div class="btns">
<button id="tabGutachtenBtn" class="btn-outline">ðŸ’— Gutachten</button>
<button id="tabPlanBtn" class="btn-outline">ðŸ“… Arbeitsplan</button>
</div>
</nav>

<!-- ================= GUTACHTEN ================= -->
<div id="sectionGutachten">

<div class="grid">

<section class="card">
<label>Gutachten</label>
<input id="gutachten">

<label>Kosten (â‚¬ max 1000)</label>
<input id="kosten" type="number">

<label>Kategorie</label>
<select id="kategorie">
<option></option>
<option>BBRZ</option>
<option>Ordination</option>
</select>

<label>Klient</label>
<input id="klient">

<label>Datum</label>
<input id="datum" type="date">

<label>Bezahlt</label>
<select id="bezahlt">
<option></option>
<option>Ja</option>
<option>Nein</option>
</select>

<div class="btns">
<button id="saveBtn">ðŸ’¾ Speichern</button>
<button id="chartBtn" class="btn-outline">ðŸ“Š Diagramm</button>
</div>

<p id="progressLabel"></p>
<div class="bar"><div id="barFill"></div></div>
</section>

<section class="card">
<div class="btns">
<button id="exportBtn" class="btn-outline">â¬‡ CSV</button>
<label class="btn-outline">
â¬† CSV
<input type="file" id="importFile" hidden>
</label>
<button id="clearBtn" class="danger">ðŸ—‘ Alles lÃ¶schen</button>
</div>

<div class="tableWrap">
<table>
<thead>
<tr>
<th>Datum</th><th>Gutachten</th><th>Kosten</th><th>Kategorie</th><th>Klient</th><th>Bezahlt</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</div>

<canvas id="chart" height="120" style="display:none"></canvas>
</section>

</div>
</div>

<!-- ================= ARBEITSPLAN ================= -->
<div id="sectionPlan" style="display:none">

<div class="grid">

<section class="card">
<label>Datum</label>
<input id="planDatum" type="date">

<label>Von</label>
<input id="planVon" type="time">

<label>Bis</label>
<input id="planBis" type="time">

<label>TÃ¤tigkeit</label>
<select id="planTaetigkeit">
<option></option>
<option>Gutachten</option>
<option>Ordination</option>
<option>BBRZ</option>
<option>Frei</option>
</select>

<label>Notiz</label>
<input id="planNotiz">

<div class="btns">
<button id="planSaveBtn">ðŸ’¾ Plan speichern</button>
<button id="planClearBtn" class="danger">ðŸ—‘ Plan lÃ¶schen</button>
</div>
</section>

<section class="card">
<p id="planStats"></p>
<div class="tableWrap">
<table>
<thead>
<tr>
<th>Datum</th><th>Zeit</th><th>TÃ¤tigkeit</th><th>Notiz</th><th>âœ”</th><th>Aktion</th>
</tr>
</thead>
<tbody id="planTbody"></tbody>
</table>
</div>
</section>

</div>
</div>

</div>

<div id="toast" class="toast"></div>

<script>
const ZIEL=45000;
const GKEY="gutachten_v1";
const PKEY="plan_v1";
const $=id=>document.getElementById(id);
const toast=t=>{const x=$("toast");x.textContent=t;x.classList.add("show");setTimeout(()=>x.classList.remove("show"),2000)}

function today(){return new Date().toISOString().slice(0,10)}

function load(k){return JSON.parse(localStorage.getItem(k)||"[]")}
function save(k,v){localStorage.setItem(k,JSON.stringify(v))}

function renderGut(){
const d=load(GKEY);
$("tbody").innerHTML="";
let sum=0;
d.forEach(e=>{
sum+=+e.Kosten||0;
$("tbody").innerHTML+=`<tr>
<td>${e.Datum}</td><td>${e.Gutachten}</td><td>${e.Kosten}</td>
<td>${e.Kategorie}</td><td>${e.Klient}</td>
<td><span class="pill ${e.Bezahlt=="Ja"?"paid":"unpaid"}">${e.Bezahlt}</span></td></tr>`
});
const p=Math.min(100,Math.floor(sum/ZIEL*100));
$("progressLabel").textContent=`${sum} â‚¬ / 45.000 â‚¬ (${p}%)`;
$("barFill").style.width=p+"%";
}

$("saveBtn").onclick=()=>{
const e={
Gutachten:$("gutachten").value,
Kosten:+$("kosten").value,
Kategorie:$("kategorie").value,
Klient:$("klient").value,
Datum:$("datum").value||today(),
Bezahlt:$("bezahlt").value
};
if(e.Kosten>1000)return alert("Max 1000 â‚¬");
const d=load(GKEY);d.push(e);save(GKEY,d);
toast("Gespeichert");
renderGut();
};

function renderPlan(){
const p=load(PKEY);
$("planTbody").innerHTML="";
let done=0;
p.forEach(i=>{
if(i.done)done++;
$("planTbody").innerHTML+=`<tr>
<td>${i.d}</td>
<td>${i.v}-${i.b}</td>
<td>${i.t}</td>
<td>${i.n}</td>
<td><input type="checkbox" ${i.done?"checked":""}
onchange="toggleDone('${i.id}')"></td>
<td>
${i.t=="Gutachten"?`<button onclick="mkGut('${i.id}')">â†’ Gutachten</button>`:""}
<button class="danger" onclick="delPlan('${i.id}')">X</button>
</td></tr>`
});
$("planStats").textContent=`${p.length} EintrÃ¤ge | ${done} erledigt`;
}

$("planSaveBtn").onclick=()=>{
const i={
id:Math.random(),
d:$("planDatum").value||today(),
v:$("planVon").value,
b:$("planBis").value,
t:$("planTaetigkeit").value,
n:$("planNotiz").value,
done:false
};
if(!i.t)return alert("TÃ¤tigkeit fehlt");
const p=load(PKEY);p.push(i);save(PKEY,p);
toast("Plan gespeichert");renderPlan();
};

function toggleDone(id){
const p=load(PKEY);
p.find(x=>x.id==id).done^=1;
save(PKEY,p);renderPlan();
}
function delPlan(id){
save(PKEY,load(PKEY).filter(x=>x.id!=id));
renderPlan();
}
function mkGut(id){
const i=load(PKEY).find(x=>x.id==id);
$("gutachten").value=i.t;
$("klient").value=i.n;
$("datum").value=i.d;
show("gut");
}

function show(w){
$("sectionGutachten").style.display=w=="gut"?"block":"none";
$("sectionPlan").style.display=w=="plan"?"block":"none";
$("tabGutachtenBtn").classList.toggle("tab-active",w=="gut");
$("tabPlanBtn").classList.toggle("tab-active",w=="plan");
}

$("tabGutachtenBtn").onclick=()=>show("gut");
$("tabPlanBtn").onclick=()=>show("plan");

$("datum").value=today();
$("planDatum").value=today();
renderGut();renderPlan();show("gut");
</script>
</body>
</html>
